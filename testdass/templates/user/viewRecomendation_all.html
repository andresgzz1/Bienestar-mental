{% load static %}
{% load embed_video_tags %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="{% static 'styles/css/recomendation.css' %}">
    <link rel="stylesheet" href="{% static 'static/img' %}"> 

    <link rel="stylesheet" href="img/">
    <title>Recomendaciones de técnicas y relajación</title>
</head>
<body>

    <!-- Inicio del menu -->
    <nav style="background: #AEAFF7; ; " class="navbar navbar-expand-lg navbar-expand-xs navbar-light">
        <div class="container-fluid">
        <!-- icono o nombre -->
  
        <a class="navbar-brand" href="#">
            <img src={% static 'img/logo.png' %} alt="logo" width="50px">
          <span style="color: #000000;">Saludem</span>
        </a>
            
        <!-- boton del menu -->
  
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#menu" aria-controls="menu" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
          <!-- elementos del menu colapsable -->
        <div class="collapse navbar-collapse " id="menu" >
          <ul class="navbar-nav ml-auto">
            <li class="nav-item ml-auto">
                <a class="nav-link" href="#">Test Autodiagnóstico</a>
            </li>
            <li class="nav-item ml-auto">
              <a class="nav-link" href="#">Técnicas de relajación</a>
            </li>
            <li class="nav-item ml-auto">
                <a  class="nav-link" href="#">Diario Emocional</a>
            </li>
            <li class="nav-item ml-auto">
                <a class="nav-link" href="#">Agendar Cita</a>
            </li>
            <li class="nav-item ml-auto">
                <a class="nav-link">FAQ</a>
            </li>
            <li class="nav-item ml-auto">


                <div class="dropdown">
                    <button class="dropdown-toggle p-0 m-0 btndropdown " type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <img src={% static 'img/logo.png' %} width="45px" style="border-radius:100%">  
                    </button>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuButton">
                      <a class="dropdown-item"  href="#">Mi Perfil</a>
                      <a class="dropdown-item"  href={% url 'logout'  %}>Cerrar Sesión</a>
                    </div>
                    
                </div>         
            </li>
            
          </ul>
        </div>
        </div>  
    </nav>

    <section>
      <br></br>
      <h1 class="title text-center ">Técnicas de relajacion</h1>
    </section>




    <div class="container-fluid">
      <div class="row">
        <div class='col-sm-5'>
          <form method="post" action="" style="width: 100%;">
            {% csrf_token %}
            {% if search == None %}
              <input class="search" name="search" id="search" type="text" placeholder='Buscar por nombre' />
            {% else %}
              <input class="search" name="search" id="search" type="text" placeholder='Buscar por nombre' value="{{search}}" />
            {% endif %}
            <button type="submit">Buscar</button>
          </form>   
        </div>
    

        <form action={% url 'viewRecomendationFilter' %} method='post' class='col-7'>
          {% csrf_token %}
          <div id="tecnicasRelajacion" class="text-right">
            <div style="margin-left:-10px" class="text-right">
              <label  class=" mw-100 " for="basic-url">Técnicas de relajacíon para:</label>
              <div class="">
                  <select  id="optionType" name="optionType" class="text-right" aria-label="" required>
                    <option disabled>Seleccione una opción:</option>
                    <option value="all" {% if filterType == 'all' %} selected {% endif %}>Todos</option>
                    <option value="depresion" {% if filterType == 'depresion' %} selected {% endif %}>Depresion</option>
                    <option value="ansiedad" {% if filterType == 'ansiedad' %} selected {% endif %}>Ansiedad</option>
                  </select>
                  
              </div>
              </div>
              <div style="margin-left:-10px" class="text-right">
                <label  class=" mw-100 " for="basic-url">Ordenar por:</label>
                <div class="">
                  <select id="filterOrden" name="filterOrden" class=" text-right" onchange="getSelectValue()">
                    <option disabled>Seleccione una opción:</option>
                    <option value="date"    {% if filterOrden == 'date'  or filterOrden == 'default' %} selected {% endif %}>Fecha</option>
                    <option value="name"    {% if filterOrden == 'name' %} selected {% endif %}>Nombre</option>
                    <option value="origen"  {% if filterOrden == 'origen' %} selected {% endif %} >Origen</option>
                    <option value="canal"   {% if filterOrden == 'canal' %} selected {% endif %}>Canal</option>
                    <option value="autor"   {% if filterOrden == 'autor' %} selected {% endif %}>Autor</option>
                  </select>
                </div>
              </div>
    
              <button type="submit" class="my-2 text-right">Filtrar</button>
    
            </div>
        </form>

      </div>
    </div>
     
          <div class="container">
            <div class="row">






              {% if h_list_paginate %}

                {% for link in h_list_paginate %}
                   
      
                  <div id="card" class="col-xs-6 col-sm-auto col-md-6 col-lg-auto">
                    <div class="card text-center">
                        <div id ="contornoCard" class="card-block">
                          <div class="embed-responsive embed-responsive-16by9">
                            {% video link.url 'tiny' %}
                          </div>
                            <div class="card-title">
                                <h6>{{link.text_title}}</h6> 
                                
                                <a href="" class="btn btn-link" data-toggle="collapse" data-target="#{{link.id}}" aria-expanded="true" aria-controls="collapseOne">Detalles</a> 
                            </div>
                            <div class="row">
                              <div class="col">
                                <div class="collapse multi-collapse" id="{{link.id}}">
                                  <div class="carta-footer card-responsive">
                                    <div class="text">Canal: {{link.canal}}</div>   
                                    <div class="text">Fecha: {{link.created_at}}</div>   
                                    <div class="text">Origen: {{link.origen}}</div>                                  
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                            
                    </div>
                    
                  </div>
                {% endfor %}

              {% else %}
                <div class="alert alert-secondary" role="alert">
                  No hay recomendaciones disponibles para la busqueda
                </div>
              {% endif %}

            </div>
          </div>

             <!-- Paginación -->
             {% if paginator.num_pages > 1 %}
             <div class="d-flex">
                 <nav aria-label="Page navigation example" class="ms-auto">
                     <ul class="pagination pagination-table">
                         {% if h_list_paginate.has_previous %}
                             <li class="page-item">
                                 <a class="page-link" href="?page={{ h_list_paginate.previous_page_number}}&search={{search}}&filterType={{filterType}}" aria-label="Previous">
                                     <span aria-hidden="true">&laquo;</span>
                                 </a>
                             </li>
                         {% else %}
                             <li class="page-item disabled">
                                 <a class="page-link" href="#" tabindex="-1">&laquo;</a>
                             </li>                        
                         {% endif %}
                         {% for i in paginator.page_range %}
                             <li class="page-item {% if h_list_paginate.number == i %}active{% endif %}">
                                 <a class="page-link" href="?page={{ i }}&search={{search}}&filterType={{filterType}}">{{ i }}</a>
                             </li>                        
                         {% endfor %}
                         {% if h_list_paginate.has_next %}
                             <li class="page-item ">
                                 <a class="page-link" href="?page={{ h_list_paginate.next_page_number }}&search={{search}}&filterType={{filterType}}">&raquo;</a>
                             </li>
                         {% else %}
                             <li class="page-item disabled">
                                 <a class="page-link" href="#" tabindex="-1">&raquo;</a>
                             </li>
                         {% endif %}
                     </ul>
                 </nav>
             </div>
             {% endif %}  
            <!-- Paginación -->    

            <script>
              window.onload = () => {
                  console.log(document.querySelector("#card > .card-title > h3:nth-child(1)").innerHTML);
              };
              getSelectValue()
              

              // Get unique values for the desired columns
              // {2 : ["M", "F"], 3 : ["RnD", "Engineering", "Design"], 4 : [], 5 : []}

              function getSelectValue() {

                var unique_col_values_dict = {}

                allFilters = document.querySelectorAll(".select-filter")
                allFilters.forEach((filter_i) => {
                    col_index = filter_i.parentElement.getAttribute("col-index");
                    // alert(col_index)
                    const rows = document.querySelectorAll("#card > .card-title")

                    rows.forEach((row) => {
                        cell_value = row.querySelector("h3:nth-child("+col_index+")").innerHTML;
                        // if the col index is already present in the dict
                        if (col_index in unique_col_values_dict) {

                            // if the cell value is already present in the array
                            if (unique_col_values_dict[col_index].includes(cell_value)) {
                                // alert(cell_value + " is already present in the array : " + unique_col_values_dict[col_index])

                            } else {
                                unique_col_values_dict[col_index].push(cell_value)
                                // alert("Array after adding the cell value : " + unique_col_values_dict[col_index])

                            }


                        } else {
                            unique_col_values_dict[col_index] = new Array(cell_value)
                        }
                    });

                    
                });

                for(i in unique_col_values_dict) {
                    alert("Column index : " + i + " has Unique values : \n" + unique_col_values_dict[i]);
                }

                updateSelectOptions(unique_col_values_dict)

              };

              // Add <option> tags to the desired columns based on the unique values

              function updateSelectOptions(unique_col_values_dict) {
                allFilters = document.querySelectorAll(".select-filter")

                allFilters.forEach((filter_i) => {
                    col_index = filter_i.parentElement.getAttribute('col-index')

                    unique_col_values_dict[col_index].forEach((i) => {
                        filter_i.innerHTML = filter_i.innerHTML + `\n<option value="${i}">${i}</option>`
                    });

                });
              };


              // Create filter_rows() function

              // filter_value_dict {2 : Value selected, 4:value, 5: value}

              function filter_rows() {
                allFilters = document.querySelectorAll(".select-filter")
                var filter_value_dict = {}

                allFilters.forEach((filter_i) => {
                    col_index = filter_i.parentElement.getAttribute('col-index')

                    value = filter_i.value
                    if (value != "all") {
                        filter_value_dict[col_index] = value;
                    }
                });

                var col_cell_value_dict = {};

                const rows = document.querySelectorAll("#card .card-title");
                rows.forEach((row) => {
                    var display_row = true;

                    allFilters.forEach((filter_i) => {
                        col_index = filter_i.parentElement.getAttribute('col-index')
                        col_cell_value_dict[col_index] = row.querySelector("h3:nth-child(" + col_index+ ")").innerHTML
                    })

                    for (var col_i in filter_value_dict) {
                        filter_value = filter_value_dict[col_i]
                        row_cell_value = col_cell_value_dict[col_i]
                        
                        if (row_cell_value.indexOf(filter_value) == -1 && filter_value != "all") {
                            display_row = false;
                            break;
                        }


                    }

                    if (display_row == true) {
                        row.style.display = "card-row"

                    } else {
                        row.style.display = "none"

                    }





                })

              }
          </script>
   

    
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
crossorigin="anonymous"></script>
<script
src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
crossorigin="anonymous"></script>
<script
src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
crossorigin="anonymous"></script>

</body>
</html>